<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Android Lifecycle Aware Modal | cdblg</title>
<meta name="keywords" content="android, arch, lifecycle">
<meta name="description" content="Sometimes we want to show the user an alert when somethings wrong or we just need to give some extra info,
For example; Ask the user if he is sure he wanna leave the app.
This can be achieved with the following code (runs inside activity):

AlertDialog.Builder(this)
  .setMessage(&#34;Are you sure you want to exit?&#34;)
  .setCancelable(false)
  .setPositiveButton(&#34;Yes&#34;, object:DialogInterface.OnClickListener() {
    fun onClick(dialog:DialogInterface, id:Int) {
      this@YourActivity.finish()
    }
  })
  .setNegativeButton(&#34;No&#34;, null)
  .show()
  
This works fine, buy there is one annoying issue, If user clicks home button while dialog displayed, and go back to the app, the dialog will still be there.
Now your user experience is seeing a question about getting out of the app while he just went in.">
<meta name="author" content="Chen Kinnrot">
<link rel="canonical" href="https://kinnrot.github.io/android-lifecycle-aware-modal/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://kinnrot.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://kinnrot.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kinnrot.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://kinnrot.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://kinnrot.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://kinnrot.github.io/android-lifecycle-aware-modal/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://kinnrot.github.io/android-lifecycle-aware-modal/">
  <meta property="og:site_name" content="cdblg">
  <meta property="og:title" content="Android Lifecycle Aware Modal">
  <meta property="og:description" content="Sometimes we want to show the user an alert when somethings wrong or we just need to give some extra info, For example; Ask the user if he is sure he wanna leave the app.
This can be achieved with the following code (runs inside activity):
AlertDialog.Builder(this) .setMessage(&#34;Are you sure you want to exit?&#34;) .setCancelable(false) .setPositiveButton(&#34;Yes&#34;, object:DialogInterface.OnClickListener() { fun onClick(dialog:DialogInterface, id:Int) { this@YourActivity.finish() } }) .setNegativeButton(&#34;No&#34;, null) .show() This works fine, buy there is one annoying issue, If user clicks home button while dialog displayed, and go back to the app, the dialog will still be there. Now your user experience is seeing a question about getting out of the app while he just went in.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-10-25T18:43:04+03:00">
    <meta property="article:modified_time" content="2018-10-25T18:43:04+03:00">
    <meta property="article:tag" content="Android">
    <meta property="article:tag" content="Arch">
    <meta property="article:tag" content="Lifecycle">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Lifecycle Aware Modal">
<meta name="twitter:description" content="Sometimes we want to show the user an alert when somethings wrong or we just need to give some extra info,
For example; Ask the user if he is sure he wanna leave the app.
This can be achieved with the following code (runs inside activity):

AlertDialog.Builder(this)
  .setMessage(&#34;Are you sure you want to exit?&#34;)
  .setCancelable(false)
  .setPositiveButton(&#34;Yes&#34;, object:DialogInterface.OnClickListener() {
    fun onClick(dialog:DialogInterface, id:Int) {
      this@YourActivity.finish()
    }
  })
  .setNegativeButton(&#34;No&#34;, null)
  .show()
  
This works fine, buy there is one annoying issue, If user clicks home button while dialog displayed, and go back to the app, the dialog will still be there.
Now your user experience is seeing a question about getting out of the app while he just went in.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://kinnrot.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Android Lifecycle Aware Modal",
      "item": "https://kinnrot.github.io/android-lifecycle-aware-modal/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Android Lifecycle Aware Modal",
  "name": "Android Lifecycle Aware Modal",
  "description": "Sometimes we want to show the user an alert when somethings wrong or we just need to give some extra info, For example; Ask the user if he is sure he wanna leave the app.\nThis can be achieved with the following code (runs inside activity):\nAlertDialog.Builder(this) .setMessage(\u0026#34;Are you sure you want to exit?\u0026#34;) .setCancelable(false) .setPositiveButton(\u0026#34;Yes\u0026#34;, object:DialogInterface.OnClickListener() { fun onClick(dialog:DialogInterface, id:Int) { this@YourActivity.finish() } }) .setNegativeButton(\u0026#34;No\u0026#34;, null) .show() This works fine, buy there is one annoying issue, If user clicks home button while dialog displayed, and go back to the app, the dialog will still be there. Now your user experience is seeing a question about getting out of the app while he just went in.\n",
  "keywords": [
    "android", "arch", "lifecycle"
  ],
  "articleBody": "Sometimes we want to show the user an alert when somethings wrong or we just need to give some extra info, For example; Ask the user if he is sure he wanna leave the app.\nThis can be achieved with the following code (runs inside activity):\nAlertDialog.Builder(this) .setMessage(\"Are you sure you want to exit?\") .setCancelable(false) .setPositiveButton(\"Yes\", object:DialogInterface.OnClickListener() { fun onClick(dialog:DialogInterface, id:Int) { this@YourActivity.finish() } }) .setNegativeButton(\"No\", null) .show() This works fine, buy there is one annoying issue, If user clicks home button while dialog displayed, and go back to the app, the dialog will still be there. Now your user experience is seeing a question about getting out of the app while he just went in.\nTo avoid this case, I found an easy solution by making my modal lifecycle aware, If your’e not sure whats lifecycle, consider read about it here.\nEvery activity/fragment implements the LifecycleOwner interface so lets add the following method:\nprivate fun subscribeToLifecycleEvents(dialog: Dialog, lifecycleOwner: LifecycleOwner?, dismissHandler: (() -\u003e Unit)? = null) { val lifecycleObserver = GenericLifecycleObserver { _, event -\u003e if (event == Lifecycle.Event.ON_PAUSE \u0026\u0026 dialog.isShowing) { dialog.dismiss() dismissHandler?.invoke() } } lifecycleOwner?.apply { this.lifecycle.addObserver(lifecycleObserver) } dialog.setOnDismissListener { lifecycleOwner?.apply { this.lifecycle.removeObserver(lifecycleObserver) } } } This method make every dialog lifecycle aware, meaning, if we add subscription to the dialog display:\nval dialog = AlertDialog.Builder(this) .setMessage(\"Are you sure you want to exit?\") .setCancelable(false) .setPositiveButton(\"Yes\", object:DialogInterface.OnClickListener() { fun onClick(dialog:DialogInterface, id:Int) { this@YourActivity.finish() } }) .setNegativeButton(\"No\", null) .show() subscribeToLifecycleEvents(dialog, this) // add subscription Every time the lifecycle owner of the modal (fragment activity or custom implementation) is paused, the dialog will be automatically dismissed.\nLifecycle architecture opens many options related to bind ui interactions with lifecycle which is extremely important for a mobile phone that can get interrupts like phone calls and messages all the time.\n",
  "wordCount" : "297",
  "inLanguage": "en",
  "datePublished": "2018-10-25T18:43:04+03:00",
  "dateModified": "2018-10-25T18:43:04+03:00",
  "author":{
    "@type": "Person",
    "name": "Chen Kinnrot"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kinnrot.github.io/android-lifecycle-aware-modal/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "cdblg",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kinnrot.github.io/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kinnrot.github.io/" accesskey="h" title="cdblg (Alt + H)">cdblg</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Android Lifecycle Aware Modal
    </h1>
    <div class="post-meta"><span title='2018-10-25 18:43:04 +0300 IDT'>October 25, 2018</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span>

</div>
  </header> 
  <div class="post-content"><p>Sometimes we want to show the user an alert when somethings wrong or we just need to give some extra info,
For example; Ask the user if he is sure he wanna leave the app.</p>
<p>This can be achieved with the following code (runs inside activity):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">AlertDialog</span>.Builder(<span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex;"><span>  .setMessage(<span style="color:#e6db74">&#34;Are you sure you want to exit?&#34;</span>)
</span></span><span style="display:flex;"><span>  .setCancelable(<span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>  .setPositiveButton(<span style="color:#e6db74">&#34;Yes&#34;</span>, <span style="color:#66d9ef">object</span>:<span style="color:#a6e22e">DialogInterface</span>.OnClickListener() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onClick</span>(dialog:DialogInterface, id:Int) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span><span style="color:#a6e22e">@YourActivity</span>.finish()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .setNegativeButton(<span style="color:#e6db74">&#34;No&#34;</span>, <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>  .show()
</span></span><span style="display:flex;"><span>  
</span></span></code></pre></div><p>This works fine, buy there is one annoying issue, If user clicks home button while dialog displayed, and go back to the app, the dialog will still be there.
Now your user experience is seeing a question about getting out of the app while he just went in.</p>
<p>To avoid this case, I found an easy solution by making my modal lifecycle aware, If your&rsquo;e not sure whats lifecycle, consider read about it <a href="https://developer.android.com/topic/libraries/architecture/lifecycle">here</a>.</p>
<p>Every activity/fragment implements the LifecycleOwner interface so lets add the following method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">subscribeToLifecycleEvents</span>(dialog: Dialog, lifecycleOwner: LifecycleOwner?, dismissHandler: (() <span style="color:#f92672">-&gt;</span> Unit)? = <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">val</span> lifecycleObserver = GenericLifecycleObserver { _, event <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">if</span> (event <span style="color:#f92672">==</span> <span style="color:#a6e22e">Lifecycle</span>.<span style="color:#a6e22e">Event</span>.ON_PAUSE <span style="color:#f92672">&amp;&amp;</span> dialog.isShowing) {
</span></span><span style="display:flex;"><span>           dialog.dismiss()
</span></span><span style="display:flex;"><span>           dismissHandler<span style="color:#f92672">?.</span>invoke()
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   lifecycleOwner<span style="color:#f92672">?.</span>apply { <span style="color:#66d9ef">this</span>.lifecycle.addObserver(lifecycleObserver) }
</span></span><span style="display:flex;"><span>   dialog.setOnDismissListener { lifecycleOwner<span style="color:#f92672">?.</span>apply { <span style="color:#66d9ef">this</span>.lifecycle.removeObserver(lifecycleObserver) } }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This method make every dialog lifecycle aware, meaning, if we add subscription to the dialog display:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">val</span> dialog = <span style="color:#a6e22e">AlertDialog</span>.Builder(<span style="color:#66d9ef">this</span>)
</span></span><span style="display:flex;"><span>  .setMessage(<span style="color:#e6db74">&#34;Are you sure you want to exit?&#34;</span>)
</span></span><span style="display:flex;"><span>  .setCancelable(<span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>  .setPositiveButton(<span style="color:#e6db74">&#34;Yes&#34;</span>, <span style="color:#66d9ef">object</span>:<span style="color:#a6e22e">DialogInterface</span>.OnClickListener() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onClick</span>(dialog:DialogInterface, id:Int) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span><span style="color:#a6e22e">@YourActivity</span>.finish()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .setNegativeButton(<span style="color:#e6db74">&#34;No&#34;</span>, <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>  .show()
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  subscribeToLifecycleEvents(dialog, <span style="color:#66d9ef">this</span>) <span style="color:#75715e">// add subscription
</span></span></span><span style="display:flex;"><span>  
</span></span></code></pre></div><p>Every time the lifecycle owner of the modal (fragment activity or custom implementation) is paused, the
dialog will be automatically dismissed.</p>
<p>Lifecycle architecture opens many options related to bind ui interactions with lifecycle which is extremely important for a mobile phone
that can get interrupts like phone calls and messages all the time.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://kinnrot.github.io/tags/android/">Android</a></li>
      <li><a href="https://kinnrot.github.io/tags/arch/">Arch</a></li>
      <li><a href="https://kinnrot.github.io/tags/lifecycle/">Lifecycle</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://kinnrot.github.io/">cdblg</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
