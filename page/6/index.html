<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head>
	<meta name="generator" content="Hugo 0.155.3"><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>cdblg</title>

<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="https://kinnrot.github.io/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://kinnrot.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://kinnrot.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kinnrot.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://kinnrot.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://kinnrot.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://kinnrot.github.io/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="https://kinnrot.github.io/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYC49T802E"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BYC49T802E');
</script>
<meta property="og:url" content="https://kinnrot.github.io/">
  <meta property="og:site_name" content="cdblg">
  <meta property="og:title" content="cdblg">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cdblg">
<meta name="twitter:description" content="">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "cdblg",
  "url": "https://kinnrot.github.io/",
  "description": "",
  "logo": "https://kinnrot.github.io/favicon.ico",
  "sameAs": [
      
  ]
}
</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kinnrot.github.io/" accesskey="h" title="cdblg (Alt + H)">cdblg</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main"> 

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Boolean parameters
    </h2>
  </header>
  <div class="entry-content">
    <p>It’s not fun to look at a method call that sends more than 0 boolean parameters.
Code SnippetSetBinding(false, false, comboBox);
There is 100% guarantee that you will look for the documentation about this parameters and it&#39;ll slow your code reading speed.
Here is a nice way to avoid the unreadable code and keep on using this meaningless Boolean.
Code Snippet SetBinding(/* auto resolve= */ false, /* two way binding? = */ false, comboBox); This is not my idea though, it&#39;s from Microsoft pdb&#39;s, and I think its awesome.</p>
  </div>
  <footer class="entry-footer"><span title='2011-08-31 07:30:00 -0700 -0700'>August 31, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to Boolean parameters" href="https://kinnrot.github.io/boolean-parameters/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">If you&#39;re searching for a good place to grow
    </h2>
  </header>
  <div class="entry-content">
    <p>http://crossrider.com/pages/jobs
I know this guys and worked with them a little, very recommended for any developer. </p>
  </div>
  <footer class="entry-footer"><span title='2011-08-04 23:47:00.001 -0700 -0700'>August 4, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to If you&#39;re searching for a good place to grow" href="https://kinnrot.github.io/if-you-searching-for-good-place-to-grow/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dont return and linq on the same line
    </h2>
  </header>
  <div class="entry-content">
    <p>Just a little tip for writing a friendlier code.
If you&#39;re method returns an expression, first assign it to a variable and then return him.
It&#39;ll be much easier to debug inside this method and fetch all results when watching this variable.
That&#39;s it !</p>
  </div>
  <footer class="entry-footer"><span title='2011-08-02 03:12:00.001 -0700 -0700'>August 2, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to Dont return and linq on the same line" href="https://kinnrot.github.io/dont-return-and-linq-on-same-line/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">TPLing Background worker in 10 min
    </h2>
  </header>
  <div class="entry-content">
    <p>Code Snippetusing System;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading;using System.Threading.Tasks; namespace WpfApplication1{ public class TBackgroundWorker&lt;TResult, TProgress&gt; {  public static TBackgroundWorker&lt;TResult, TProgress&gt; New() { return new TBackgroundWorker&lt;TResult, TProgress&gt;(); }  public TBackgroundWorker&lt;TResult, TProgress&gt; StartWith(Func&lt;object, CancellationToken, TResult&gt; work) { Start = work; return this; }  public TBackgroundWorker&lt;TResult, TProgress&gt; FinishWith(Action&lt;TResult,object&gt; finish) { Finish = finish; return this; }  private readonly CancellationTokenSource _cancelationTokenSource; private CancellationToken _cancellationToken; private readonly TaskScheduler _uiScheduler;   public TBackgroundWorker() { _cancelationTokenSource = new CancellationTokenSource(); _uiScheduler = TaskScheduler.FromCurrentSynchronizationContext(); }  protected Func&lt;object, CancellationToken,TResult&gt; Start { get; set; } protected Action&lt;TResult, object&gt; Finish { get; set; }  public void ReportProgress(Action&lt;TProgress&gt; progressReport,TProgress progress) { Task.Factory.StartNew(()=&gt;progressReport(progress),CancellationToken.None,TaskCreationOptions.None,_uiScheduler); }  public TBackgroundWorker&lt;TResult, TProgress&gt; Begin(object state = null) { _cancellationToken = _cancelationTokenSource.Token; Task&lt;TResult&gt;.Factory. StartNew(()=&gt;Start(state,_cancellationToken),_cancellationToken). ContinueWith(x =&gt; Finish(x.Result,state), _uiScheduler);  return this; }  public void Cancel() { _cancelationTokenSource.Cancel(true); } }}
usage
Code Snippetusing System;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading;using System.Windows;using System.Windows.Controls;using System.Windows.Data;using System.Windows.Documents;using System.Windows.Input;using System.Windows.Media;using System.Windows.Media.Imaging;using System.Windows.Navigation;using System.Windows.Shapes; namespace WpfApplication1{ /// &lt;summary&gt; /// Interaction logic for MainWindow.xaml /// &lt;/summary&gt; public partial class MainWindow : Window { private TBackgroundWorker&lt;string, int&gt; _bg;  public MainWindow() { InitializeComponent(); }  private void a_Click(object sender, RoutedEventArgs e) { _bg = TBackgroundWorker&lt;string, int&gt;.New(). StartWith(StartSomething). FinishWith(ShowResult). Begin(); }  private void ShowResult(string obj,object state) { a.Content = obj; }  private string StartSomething(object arg, CancellationToken cancellationToken) { int i = 0; while (i &lt; 200) { if (cancellationToken.IsCancellationRequested) { return &#34;Cacncelled&#34;; } i&#43;&#43;; Thread.Sleep(50); _bg.ReportProgress(Report,i); }  return &#34;Done&#34;; }  private void Report(int obj) { a.Content = obj; }  private void Button_Click(object sender, RoutedEventArgs e) { _bg.Cancel(); }  }}</p>
  </div>
  <footer class="entry-footer"><span title='2011-06-16 01:40:00 -0700 -0700'>June 16, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to TPLing Background worker in 10 min" href="https://kinnrot.github.io/tpling-background-worker-in-10-min/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Passing complex type through WCF header,The simple always work version.
    </h2>
  </header>
  <div class="entry-content">
    <p>Recently I tried to find a nice code sample for how to pass complex type through WCF, inside the header, meaning I want to send the client execution context to the server side.
All of the samples passes strings or uses custom header that needs to write and read the object manually, I didn’t like it.
So I wrote one and it’s working!
All you need is 2 classes, and one is just a factory for the other, very simple:
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.Serialization;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Dispatcher;
using System.Text;
namespace debugniv.ComplexTypeOverWcf
{
class HeaderHandler : IDispatchMessageInspector, IClientMessageInspector
{
#region Implementation of IDispatchMessageInspector
public object AfterReceiveRequest(ref Message request, IClientChannel channel, InstanceContext instanceContext)
{
// Read the complex type from header
var headerIndex = request.Headers.FindHeader(typeof(MyHeader).Name, typeof(MyHeader).Namespace);
if (headerIndex &gt;= 0) // found!
{
var serializer = GenerateDataContractSerializer&lt;MyHeader&gt;();
var myHeader = request.Headers.GetHeader&lt;MyHeader&gt;(headerIndex, serializer);
// here you can do something with your header like push it to a global per request context.
}
return null;
}
public void BeforeSendReply(ref Message reply, object correlationState)
{
// nothing here
}
#endregion
#region Implementation of IClientMessageInspector
public object BeforeSendRequest(ref Message request, IClientChannel channel)
{
var myHeader = GetMyHeader();
request.Headers.Add(myHeader);
}
public void AfterReceiveReply(ref Message reply, object correlationState)
{
// nothing to do here
}
#endregion
private DataContractSerializer GenerateDataContractSerializer&lt;T&gt;()
{
return new DataContractSerializer(typeof(T), typeof(T).Name, typeof(T).Namespace, GetKnownTypes());
}
private IEnumerable&lt;Type&gt; GetKnownTypes()
{
// here return all your types inside the header
yield return typeof(MyHeader);
yield return typeof(SubType);
}
private MessageHeader GetMyHeader()
{
var data = new MyHeader();
var serializer = GenerateDataContractSerializer&lt;MyHeader&gt;();
return MessageHeader.CreateHeader(data.GetType().Name, data.GetType().Namespace, data, serializer);
}
}
// this is the header internal class MyHeader
{
public SubType InternalData { get; set; }
}
internal class SubType
{
}
}
The second thing you’ll need is to attach this stuff to your service and proxy, here is one way to do this
using System;
using System.ServiceModel.Configuration;
namespace debugniv.ComplexTypeOverWcf
{
public class HeaderExtensionElement : BehaviorExtensionElement
{
public override Type BehaviorType
{
get { return typeof (HeaderHandler); }
}
protected override object CreateBehavior()
{
return new HeaderHandler();
}
}
}
In you config file add the following </p>
  </div>
  <footer class="entry-footer"><span title='2011-05-02 10:05:00 -0700 -0700'>May 2, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to Passing complex type through WCF header,The simple always work version." href="https://kinnrot.github.io/passing-complex-type-through-wcf/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">IOC Container warning
    </h2>
  </header>
  <div class="entry-content">
    <p>Think about a registered component that implement copy constructor.
You’ll get a Stack Overflow Exception!
So avoid it.
</p>
  </div>
  <footer class="entry-footer"><span title='2011-04-23 11:44:00 -0700 -0700'>April 23, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to IOC Container warning" href="https://kinnrot.github.io/ioc-container-warning/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Prevent setting a property value after already been set
    </h2>
  </header>
  <div class="entry-content">
    <p>Let’s say we write an infrastructure of entities and their interaction with Nhibernate and the rest of the server side logic.
We want Nhibernate to do whatever it needs. But we also want to limit the application programmer from doing crazy things, for example: Setting the Unique Identifier of an existing entity to another value. I know it sounds crazy but in a medium-sized team, anything can happen and this stuff is critical for the future.
So I thought about a very KIS way to implement this kind of protection.
* What I write here is the most readable version of my code, you can extract method, use interceptor, AOP, whatever works for you.
private long _id;
public long ID
{
get { return _id; }
set
{
if (!_id.Equals(default(long)) &amp;&amp; !_id.Equals(value))
{
throw new InvalidOperationException(
“You can’t set this property, it has already been set”);
}
_id = value;
}
}
Very simple, easy to test, and it works with NHibernate proxy.
</p>
  </div>
  <footer class="entry-footer"><span title='2011-04-04 08:52:00 -0700 -0700'>April 4, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to Prevent setting a property value after already been set" href="https://kinnrot.github.io/preventing-from-setting-property-value/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Per DB Conventions With FluentNhibernate
    </h2>
  </header>
  <div class="entry-content">
    <p>I need to support 2 db types on my app, so I thought about a nice pattern that will help me achieve this.
// I’m working with latest Fluent Nhibernate version.
Define a folder for each db type you want to support like this:
contain conventions for MSSQLCE and the second will contain conventions for OracleClient.
For example: Oracle support schemas and sequences, SQLCE does not. lets define some simple conventions
For Oracle:
public class SchemaConvention : IClassConvention
{
public void Apply(IClassInstance instance)
{
instance.Schema(“MY_ORACLE_SPECIFIC_SCHEMA”);
}
}
public class SequenceConvention : IIdConvention
{
public void Apply(IIdentityInstance instance)
{
instance.GeneratedBy.Sequence(instance.Columns.First().Name &#43; “_SEQ”);
}
}
And for SqlCe:
class IdentityConvention : IIdConvention
{
public void Apply(IIdentityInstance instance)
{
instance.GeneratedBy.Identity();
}
}
So the folders will look like this:
Next thing that we will need is some kind of type retriever that knows what conventions to load according to the db we are currently configuring his nhibernate stuff.
Lets call it PerDBConventionSource and this is how its implemented:
internal class PerDBConventionSource : ITypeSource
{
private readonly string _name;
private IEnumerable&lt;Type&gt; _types;
public PerDBConventionSource(string name)
{
_name = name;
}
public IEnumerable&lt;Type&gt; GetTypes()
{
_types = typeof (PerDBConventionSource).Assembly.GetTypes().Where(t =&gt; t.Namespace.EndsWith(_name));
return _types;
}
/// &lt;summary&gt;
/// Logs the activity of this type source.
/// &lt;/summary&gt;
/// &lt;param name=“logger”&gt;The logger.&lt;/param&gt;
public void LogSource(IDiagnosticLogger logger)
{
// TODO : Log if you want
}
public string GetIdentifier()
{
return _name;
}
}
Notice that i’m implementing ITypeSource, an interface belong to FluentNhibernate, this is how i tell FluentNhibernate to use this as a convention source: (I used only fluentMappings so I add the conventions only on fluentMappings)
private static IPersistenceConfigurer _persistenceConfigurer;
private static void ConfigureNH(IPersistenceConfigurer persistenceConfigurer)
{
_persistenceConfigurer = persistenceConfigurer;
Fluently.
Configure().
Database(persistenceConfigurer).
Diagnostics(x =&gt; x.Enable(true).OutputToConsole()).
Mappings(SomeMappings).
BuildConfiguration();
}
private static void SomeMappings(MappingConfiguration mappingConfiguration)
{
string name = _persistenceConfigurer.GetType().Name.Replace(“Configuration”, string.Empty);
mappingConfiguration.FluentMappings.Conventions.AddSource(new PerDBConventionSource(name));
}
So when I’ll run the following code:
Console.BackgroundColor = ConsoleColor.DarkGreen;
Console.ForegroundColor= ConsoleColor.Green;
ConfigureNH(OracleClientConfiguration.Oracle10.ConnectionString(“some OracleClient connection”));
Console.BackgroundColor = ConsoleColor.DarkBlue;
Console.ForegroundColor = ConsoleColor.Blue;
ConfigureNH(MsSqlCeConfiguration.Standard.ConnectionString(“some MsSqlCe connection”));
The result will be
Why you should use his pattern anyway(even if you work with 1 db):
1. unit testing with sqlite in memory will not work with sequence conventions, so you shouldn’t load them when you are unit testing.
2. If you’ll some day change the db type, you’ll know where to add its own conventions, just create a folder with db name and add it’s conventions inside no other change is necessary.
You can find the source here:
</p>
  </div>
  <footer class="entry-footer"><span title='2011-02-18 11:30:00 -0800 -0800'>February 18, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to Per DB Conventions With FluentNhibernate" href="https://kinnrot.github.io/per-db-conventions-with/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Building a business tier with Nhibernate - Tools
    </h2>
  </header>
  <div class="entry-content">
    <p>I got a new task: Build Nhibernate based infrastructure, so I decided to check the existing third party tools and my boss gave me a day at home to check them ;-D .
I only check tools that:
based on existing DB support oracle works with NH 3First tool I got my hands on is NH3SQLLogger NH3SQLLogger - Nhibernate 3 SQL logger, this is a cool utility that will help you understand what the hell nhibernate is doing , where he is doing his stuff (yes yes a stack trace) and all parameters of queries are also reflected, this is the perfect development time logger.
do not active it on production by default, only if you need to debug prod.
Here is a sample output of this util:
—&#43; 01/24/2011 10:14:42.57 &#43;—
– Void Logic.Test.UserRepositoryTest.SaveUser() [File=UserRepositoryTest.cs, Line=86]
INSERT INTO
“User”
(FirstName, LastName, BirthDate, Gender, PhoneNumber, IsDeleted, Created, LastUpdated, Name, Address_id, FacebookProfile_id) VALUES
(@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
select
last_insert_rowid();
@p0 = ‘Chen’ [Type: String (0)]
@p1 = ‘Kinnrot’ [Type: String (0)]
@p2 = 24/01/2011 00:00:00 [Type: DateTime (0)]
@p3 = ‘Male’ [Type: String (0)]
@p4 = ‘0578149177’ [Type: String (0)]
@p5 = False [Type: Boolean (0)]
@p6 = 01/01/0001 00:00:00 [Type: DateTime (0)]
@p7 = 01/01/0001 00:00:00 [Type: DateTime (0)]
@p8 = ‘kinnrot’ [Type: String (0)]
@p9 = 1 [Type: Int64 (0)]
@p10 = 1 [Type: Int64 (0)]
NHibernator
Allows you to load db configuration by a key in the configuration file, good for application that works with more than one DB.Wraps sessions and transactions for session per HTTP session and session per thread. No download available only codeNHibernateIt Allows you to do some basic crud through a generic repository implementation. Has the same session and transaction encapsulation as in Nhibernator.Nhibenrate Mapping Generator - Don’t know if working(Need to test on a big DB), but should generate mappings and classes from existing db, support MSSQL,Oracle and Postgre SQL.
If you got a DB and don’t go fluent, this is probably good solution for a quick start.
Fluent Nhibernate - Framework with fluent interface based mapping and configuration.
Has an auto map feature with a lot of flexible convention over configuration options. One more thing they supply is an easy to use mapping test classes (called PersistenceSpecification ).
You should consider auto mapping if your DB got name conventions, but you loose the flexibility of the mapping file per entity built in Nhibernate, and non conventional changes will make you write patches (AutoMappingOverride).
</p>
  </div>
  <footer class="entry-footer"><span title='2011-01-24 08:06:00 -0800 -0800'>January 24, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to Building a business tier with Nhibernate - Tools" href="https://kinnrot.github.io/building-business-tier-with-nhibernate/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">WPF Binding and Why you should write defensive code.
    </h2>
  </header>
  <div class="entry-content">
    <p>I’m overriding equals and implementing IEquatable on some of my objects and bind them as an ObservableCollection to the UI.
Here is a sample: (ugly code do not use)
&lt;Window x:Class=“BindingToItemsWithIEquality.MainWindow”
xmlns=“http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34;
xmlns:x=“http://schemas.microsoft.com/winfx/2006/xaml&#34;
xmlns:local=“clr-namespace:BindingToItemsWithIEquality”
Title=“MainWindow” Height=“350” Width=“525”
&gt;
&lt;Window.DataContext&gt;
&lt;local:SomeContextWithCollection/&gt;
&lt;/Window.DataContext&gt;
&lt;StackPanel&gt;
&lt;ListBox DisplayMemberPath=“Name” ItemsSource=&#34;{Binding Items}”/&gt;
&lt;Button Click=“Button_Click”&gt;clear&lt;/Button&gt;
&lt;/StackPanel&gt;
&lt;/Window&gt;
//code behind
private void Button_Click(object sender, RoutedEventArgs e)
{
(this.DataContext as SomeContextWithCollection).Items.Clear();
}
public class SomeContextWithCollection {
public ObservableCollection&lt;SomeIEqutable&gt; Items { get; set; }
public SomeContextWithCollection()
{
Items = new ObservableCollection&lt;SomeIEqutable&gt;();
Items.Add(new SomeIEqutable() { Name = “1” });
Items.Add(new SomeIEqutable() { Name = “2” });
}
}
public class SomeIEqutable : IEquatable&lt;SomeIEqutable&gt;
{
public string Name { get; set; }
public override bool Equals(object obj)
{
if (obj == null)
{
return false;
}
return Equals((SomeIEqutable)obj);
}
public bool Equals(SomeIEqutable other)
{
if (object.ReferenceEquals(this, other))
{
return true;
}
return Name == other.Name;
}
public override int GetHashCode()
{
return Name.GetHashCode();
}
}
When calling collection.Clear() I get an invalid cast inside my equals method, when trying to cast to SomeIEquatable.
This is pretty strange, object is not null and not SomeIEquatlabe, how did it get to my Equals?
The answer is WPF, when working with binding and clearing a bounded collection WPF will compare his internal new MSInternal.NamedObject(named DisconnectedItem) to your SomeIEquatable object and will fail if you try to implicitly cast it to your type.
The simple solution is to use the “as” keyword instead of cast.
If my code didn’t smell from the start, I would never got to this dark place. But I’m glad it happened, now I have another excuse to write defensive code.
</p>
  </div>
  <footer class="entry-footer"><span title='2011-01-05 14:47:00 -0800 -0800'>January 5, 2011</span>&nbsp;·&nbsp;<span>Chen Kinnrot</span></footer>
  <a class="entry-link" aria-label="post link to WPF Binding and Why you should write defensive code." href="https://kinnrot.github.io/wpf-binding-and-why-you-should-write/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="https://kinnrot.github.io/page/5/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="https://kinnrot.github.io/page/7/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://kinnrot.github.io/">cdblg</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
